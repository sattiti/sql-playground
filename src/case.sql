-- CASE
-- 各分岐の戻り値の型が一致する必要がある。
-- 集約関数と GROUP BY 句と一緒に使うと効果絶大。

-- CASE はどこにでも書ける。
-- SELECT
-- WHERE
-- UPDATE
-- GROUP BY
-- HAVING
-- ORDER BY
-- PARTITION BY
-- CHECK
-- 関数の引数
-- 述語の引数
-- 他の式の中(CASE 入れ子等

-- CASE 入れ子
-- Simple CASE {{{
SELECT 
  CASE COL
    WHEN VAL1 THEN RESULT1
    WHEN VAL2 THEN RESULT2
    ELSE RESULT3
  END AS ALIAS1
  FROM TB
  GROUP BY
    CASE COL
      WHEN VAL1 THEN RESULT1
      WHEN VAL2 THEN RESULT2
      ELSE RESULT3
    END
;
-- }}}

-- Searched CASE {{{
SELECT
  CASE
    WHEN CONDITION1 THEN RESULT1
    WHEN CONDITION2 THEN RESULT2
    ELSE RESULT3
  END AS ALIAS1
  FROM TB
  GROUP BY ALIAS1
;
-- }}}

-- UPDATE {{{
UPDATE TB
  SET COL =
    CASE
      WHEN COLDITION1 THEN RESULT1
      WHEN COLDITION2 THEN RESULT2
      ELSE RESULT3
    END
;
      
-- }}}